spark-uri = null

sparknlp.settings.overrideConfigPath = "sparknlp.conf"

common {
  default-steps = [
    "all"
  ]
  output-format = "parquet"
  output = "gs://open-targets-pre-data-releases/21.06.3/output/literature-etl/parquet"

  publication-section-ranks = [
    {section: "title", rank: 1, weight: 1}
    {section: "abstract", rank: 2, weight: 0.8}
    {section: "concl", rank: 3, weight: 0.6}
    {section: "discuss,concl", rank: 3, weight: 0.6}
    {section: "discuss", rank: 4, weight: 0.5 }
    {section: "results", rank: 5, weight: 0.4 }
    {section: "results,discuss", rank: 5, weight: 0.4 }
    {section: "methods,results", rank: 6, weight: 0.3 }
    {section: "methods,concl", rank: 6, weight: 0.3 }
    {section: "methods,discuss", rank: 6, weight: 0.3 }
  ]
  // default rank 100, and weight 0.01
}

# this is a temporal lut for pmcid to pmid
# http://ftp.ebi.ac.uk/pub/databases/pmc/DOI/PMID_PMCID_DOI.csv.gz
processing {
  epmcids {
    format = "csv"
    path = "gs://open-targets-pre-data-releases/21.06.3/input/literature/PMID_PMCID_DOI.csv.gz"
    options = [
      {k: "header", v: "true"}
      {k: "inferSchema", v: "true"}
    ]
  }
  diseases {
    format = "parquet"
    path = "gs://open-targets-pre-data-releases/21.06.3/input/literature/parquet/diseases"
  }

  targets {
    format = "parquet"
    path = "gs://open-targets-pre-data-releases/21.06.3/input/literature/parquet/targets"
  }
  drugs {
    format = "parquet"
    path = "gs://open-targets-pre-data-releases/21.06.3/input/literature/parquet/molecule"
  }
  epmc {
    format = "json"
    path = "gs://otar025-epmc/21.06/**/"
  }
  outputs = {
    grounding = {
      format = ${common.output-format}
      path = ${common.output}"/grounding"
    }
    raw-evidence {
      format = ${common.output-format}
      path = ${common.output}"/rawEvidence"
    }
    cooccurrences {
      format = ${common.output-format}
      path = ${common.output}"/cooccurrences"
    }
    matches {
     format = ${common.output-format}
     path = ${common.output}"/matches"
    }
    literature-index {
      format = "json"
      path = ${common.output}"/literatureIndex"
    }
  }
}

embedding {
  num-synonyms = 50
  model-configuration {
    window-size = 5
    num-partitions = 8
    max-iter = 3
    min-count = 1
    step-size = 0.025
  }
  input = ${processing.outputs.matches}
  output = {
    format = ${common.output-format}
    path = ${common.output}"/W2VModel"
  }
}

vectors {
  input = ${embedding.output.path}
  output {
    format = "json"
    path = ${common.output}"/vectors"
  }
}

evidence {
  // mean and std per unique keywords across all pmids per section
  //+---------+------------------+------------------+
  //|section  |meank             |stdk              |
  //+---------+------------------+------------------+
  //|abbr     |4.750344984333653 |6.309959232161829 |
  //|ack_fund |1.440402728158493 |4.015271072640654 |
  //|auth_cont|1.395447701709326 |1.0478087140025882|
  //|discuss  |7.649293420634873 |7.0212506320793455|
  //|title    |1.33529638436395  |0.7137758877595416|
  //|intro    |6.008737068524019 |6.327062926288552 |
  //|concl    |2.547289597205545 |2.897049436552844 |
  //|other    |11.371259020545256|22.932854851075156|
  //|appendix |6.878936319104269 |21.54381807880528 |
  //|ref      |10.437139561707037|12.50748627687029 |
  //|methods  |7.165571654334116 |7.878631024074429 |
  //|comp_int |1.729933110367893 |2.8108349479719745|
  //|case     |8.624327062926941 |7.154739988056225 |
  //|results  |8.608975592939705 |12.921220241324688|
  //|abstract |2.940045199195874 |2.2657219409950042|
  //|suppl    |3.551023850152784 |7.799985235529268 |
  //+---------+------------------+------------------+
  //
  // unique pmids and unique keywords
  //+---------+--------+--------+
  //|  section|   pmids|keywords|
  //+---------+--------+--------+
  //|     abbr|   61597|   14495|
  //| ack_fund|    6158|    1859|
  //|auth_cont|   11291|    4543|
  //|  discuss| 1669310|   37994|
  //|    title| 9988533|   34554|
  //|    intro| 1854970|   35846|
  //|    concl|  687075|   26395|
  //|    other| 1072413|   40217|
  //| appendix|    7145|   11406|
  //|      ref|    5202|    9159|
  //|  methods| 1692675|   35843|
  //| comp_int|    5980|    2842|
  //|     case|  145073|   15347|
  //|  results| 1589622|   41293|
  //| abstract|13459089|   40493|
  //|    suppl|  100796|   20057|
  //+---------+--------+--------+
  publication-section-ranks = [
    {section: "title", rank: 1, weight: 1}
    {section: "abstract", rank: 1, weight: 1}
    {section: "concl", rank: 1, weight: 1}
    {section: "results", rank: 2, weight: 1}
    {section: "discuss", rank: 2, weight: 1}
    {section: "methods", rank: 3, weight: 1}
  ]
  skip-model = false
  model-configuration {
    window-size = 5
    num-partitions = 32
    max-iter = 1
    min-count = 1
    step-size = 0.025
  }
  threshold = 0.001
  input  = ${processing.outputs.matches}
  outputs = {
    evidence = {
      format = ${common.output-format}
      path = ${common.output}"/evidence"
    }
    model = {
      format = ${common.output-format}
      path = ${common.output}"/evidenceW2VModel"
    }
  }
}